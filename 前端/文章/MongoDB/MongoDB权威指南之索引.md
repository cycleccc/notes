# 前言
本章介绍 MongoDB 的索引。索引使你能够高效地执行查询。它们是应用程序开发的重要组成部分，甚至对于某些类型的查询是必需的。

# 索引简介
数据库索引类似于图书索引。有了索引便不需要浏览整本书，只查看一个有内容引用的有序列表。这使得 MongoDB 的查找速度提高了`好几个数量级`。

不使用索引的查询称为`集合扫描`，这意味着服务器端必须“浏览整本书”才能得到查询的结果。

**查询模式**

为了使 MongoDB 高效地响应查询，应用程序中的所有查询模式都应该有`索引支持`。

所谓查询模式，是指`应用程序向数据库提出的不同类型的问题`。例如按用户名查询 users 集合。这就是一个特定查询模式的示例。

## 创建索引

创建索引可以使用 **createIndex** 集合方法。

```shell
> db.users.createIndex({"username" : 1})
{
    "createdCollectionAutomatically" : false,
    "numIndexesBefore" : 1,
    "numIndexesAfter" : 2,
    "ok" : 1
}
```

创建索引只需几秒的时间，除非集合特别大。如果 createIndex 调用在几秒后没有返回，则可以运行 `db.currentOp()`（在另一个 shell 中）或检查 `mongod 的日志`以查看索引创建的进度。

索引可以显著缩短查询时间。然而，`使用索引是有代价的`：修改索引字段的写操作（插入、更新和删除）会花费更长的时间。这是因为在更改数据时，除了更新文档，MongoDB 还`必须更新索引`。

要选择为哪些字段创建索引，可以查看常用的查询、需要快速执行的查询以及遇到性能瓶颈的查询，并尝试从中找到一组通用的键。

## 复合索引简介

对于许多查询模式来说，在两个或更多的键上创建索引是必要的。

例如，可以在 "age" 和"username" 上创建索引，如果查询中有多个排序方向或者查询条件中有多个键，那么这个索引会非常有用。

```JavaScript
> db.users.createIndex({"age" : 1, "username" : 1})
```

上例创建的称为`复合索引`（compound index）。复合索引是创建在多个字段上的索引。



