# 前言
	上一章节介绍了增删改，本章使用单独一章来介绍查，主要涵盖以下几个方面：使用 $ 条件进行范围查询、数据集包含查询、不等式查询，以及其他一些查询；查询会返回一个数据库游标，其只会在需要时才惰性地进行批量返回；有很多可以针对游标执行的元操作，包括跳过一定数量的结果、限定返回结果的数量，以及对结果进行排序。

# find简介

使用find 方法来进行查询,空的查询文档（{}）会匹配集合中的所有内容。如果 find 没有给定查询文档，则默认为 {}。
```stylus
> db.c.find()
> // 返回集合C中的所有文档
```

当开始向查询文档中添加键–值对时，就意味着限定了查询条件。
可以在查询文档中加入多个键–值对，以将多个查询条件组合在一起，这样的查询条件会被解释为“条件 1 AND 条件 2 AND...AND 条件 N ”。

```stylus
> db.users.find({"username" : "joe", "age" : 27})
```

## 指定要返回的键

有时候并不需要返回文档中的所有键–值对。遇到这种情况时，可以通过 find（或者 findOne）的第二个参数来指定需要的键。这样做既可以：
1. 节省网络传输的数据量。
2. 也可以减少客户端解码文档的时间和内存消耗。

```stylus
> db.users.find({}, {"username" : 1, "email" : 1})
{
    "_id" : ObjectId("4ba0f0dfd22aa494fd523620"),
    "username" : "joe",
    "email" : "joe@example.com"
}
```

默认情况下 "\_id" 键总是会被返回，即使没有指定要返回这个键。

也可以用第二个参数来剔除查询结果中的某些键–值对。同样可以将 "\_id" 键从返回结果中剔除。

```stylus
> db.users.find({}, {"username" : 1, "_id" : 0})
{
    "username" : "joe"
}
```

## 限制

查询在使用上是有一些限制的。传递给数据库的查询文档的值必须是常量。

# 查询条件

	查询不仅能像上一节描述的那样进行精确匹配，还可以匹配更加复杂的条件，比如范围、OR 子句以及取反。

## 查询条件

"\$lt"、"\$lte"、"\$gt" 、"\$gte" 和 "\$ne" 都属于比较运算符，分别对应 <、<=、> 和>=、!=。可以将它们组合使用以查找一个范围内的值。

例如，要查询 18 到 30 岁的用户，可以进行如下操作：

```stylus
> db.users.find({"age" : {"$gte" : 18, "$lte" : 30}})
```

## OR查询
MongoDB 中有两种方式可以进行 OR 查询。"\$in" 可以用来查询一个键的多个值。"\$or" 则更通用一些，可以在多个键中查询任意的给定值。

如果一个键需要与多个值进行匹配，那么可以将一个条件数组与 "$in" 一起使用。

```stylus
> db.raffle.find({"ticket_no" : {"$in" : [725, 542, 390]}})
```

与 "\$in" 相反的是 "\$nin"，此运算符会返回与数组中所有条件都不匹配的文档。如果想返回所有没有中奖的人，可以这样进行查询：

```stylus
> db.raffle.find({"ticket_no" : {"$nin" : [725, 542, 390]}})
```

如果想找到满足多个条件中部分或全部条件的文档可以使用\$or。

```stylus
> db.raffle.find({"$or" : [{"ticket_no" : 725}, {"winner" : true}]})
```

对于普通的 AND 类型查询，我们总是希望尽可能用最少的参数来限定结果的范围。OR 类型的查询则相反：如果第一个参数能够匹配`尽可能多`的文档，则其效率最高。

### $not
"$not" 是一个元条件运算符：可以用于任何其他条件之上。也就是取反。

# 特定类型的查询

如第 2 章所述，MongoDB 在一个文档中可以使用多种类型的数据，其中一些类型在查询时会有特别的行为。

## null

null 的行为有一些特别。它可以与自身匹配，null即会匹配为值为null的文档也会匹配`不存在`这个条件。

如果仅想匹配键值为 null 的文档，则需要检查该键的值是否为 null，并且通过"`$exists`" 条件确认该键已存在。

## 正则表达式

"$regex" 可以在查询中为字符串的模式匹配提供正则表达式功能。这里不扩展了，使用的是 Perl 兼容的正则表达式，`反正也记不住`

## 查询数组

查询数组元素的方式与查询标量值相同。

**"$all"**
如果需要通过多个元素来匹配数组，那么可以使用 "$all"。这允许你匹配一个元素列表。
```stylus
> db.food.find({fruit : {$all : ["apple", "banana"]}})
{"_id" : 1, "fruit" : ["apple", "banana", "peach"]}
{"_id" : 3, "fruit" : ["cherry", "banana", "apple"]}
```

也可以使用整个数组进行精确匹配。不过，精确匹配无法匹配上元素`丢失、多余或顺序不同 `的文档。

如果想在数组中查询特定位置的元素，可以使用 `key.index` 语法来指定下标。

```stylus

```